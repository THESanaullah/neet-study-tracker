{% extends "admin/admin_base.html" %}

{% block title %}Admin Dashboard - NEET Study Tracker{% endblock %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <h1>Admin Dashboard</h1>
    <p class="text-muted">System overview and user management</p>
</div>

<!-- Statistics Cards -->
<div class="dashboard-grid">
    <div class="stat-card" style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);">
        <h3>Total Users</h3>
        <div class="stat-value">{{ total_users }}</div>
        <div class="stat-label">Registered students</div>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
        <h3>Active Users</h3>
        <div class="stat-value">{{ active_users }}</div>
        <div class="stat-label">Approved accounts</div>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
        <h3>Pending Approval</h3>
        <div class="stat-value">{{ pending_users }}</div>
        <div class="stat-label">Awaiting review</div>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
        <h3>Approval Rate</h3>
        <div class="stat-value">{{ "%.0f"|format((active_users / total_users * 100) if total_users > 0 else 0) }}%</div>
        <div class="stat-label">Approved vs Total</div>
    </div>
</div>

<!-- Quick Actions -->
<div style="margin: 2rem 0; display: flex; gap: 1rem; flex-wrap: wrap;">
    <a href="{{ url_for('pending_users') }}" class="btn btn-warning btn-lg">
        ‚è≥ Review Pending Users ({{ pending_users }})
    </a>
    <a href="{{ url_for('manage_users') }}" class="btn btn-primary btn-lg">
        üë• Manage All Users
    </a>
</div>

<!-- Recent Registrations -->
{% if recent_users|length > 0 %}
<div class="card" style="margin-bottom: 2rem;">
    <div class="card-header">
        <h3 class="card-title">üë§ Recent Registrations</h3>
    </div>
    <div class="card-body" style="padding: 0;">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Full Name</th>
                        <th>Target Year</th>
                        <th>Registered</th>
                        <th>Status</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in recent_users %}
                    <tr>
                        <td><strong>{{ user.username }}</strong></td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.full_name or '-' }}</td>
                        <td>{{ user.target_exam_year or '-' }}</td>
                        <td>{{ user.created_at.strftime('%d/%m/%Y') }}</td>
                        <td>
                            {% if user.is_active %}
                                <span class="badge badge-success">‚úì Active</span>
                            {% else %}
                                <span class="badge badge-warning">‚è≥ Pending</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.is_active %}
                                <a href="{{ url_for('view_user_progress', user_id=user.id) }}" class="btn btn-sm btn-outline">
                                    View ({{ user.get_progress_percentage() }}%)
                                </a>
                            {% else %}
                                <a href="{{ url_for('pending_users') }}" class="btn btn-sm btn-warning">
                                    Review
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- Admin Action Log -->
{% if recent_actions|length > 0 %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">üìã Recent Admin Actions</h3>
    </div>
    <div class="card-body" style="padding: 0;">
        <div class="table-container">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date & Time</th>
                        <th>Admin</th>
                        <th>Action</th>
                        <th>Target User</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for action in recent_actions %}
                    <tr>
                        <td>{{ action.created_at.strftime('%d/%m/%Y %I:%M %p') }}</td>
                        <td><strong>{{ action.admin.username }}</strong></td>
                        <td>
                            {% if action.action_type == 'approve' %}
                                <span class="badge badge-success">Approved</span>
                            {% elif action.action_type == 'reject' %}
                                <span class="badge badge-danger">Rejected</span>
                            {% elif action.action_type == 'deactivate' %}
                                <span class="badge badge-warning">Deactivated</span>
                            {% elif action.action_type == 'delete' %}
                                <span class="badge badge-danger">Deleted</span>
                            {% elif action.action_type == 'view' %}
                                <span class="badge badge-info">Viewed</span>
                            {% else %}
                                <span class="badge badge-secondary">{{ action.action_type }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if action.target_user %}
                                {{ action.target_user.username }}
                            {% else %}
                                <span class="text-muted">User deleted</span>
                            {% endif %}
                        </td>
                        <td>{{ action.description }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}
