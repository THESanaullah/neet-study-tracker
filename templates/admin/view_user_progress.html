{% extends "admin/admin_base.html" %}

{% block content %}
<h1>User: {{ user.username }}</h1>

<div class="card">
    <h2>User Information</h2>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Full Name:</strong> {{ user.full_name or 'N/A' }}</p>
    <p><strong>Target Year:</strong> {{ user.target_exam_year or 'N/A' }}</p>
    <p><strong>Status:</strong> 
        {% if user.is_active %}
            <span style="color: #16a34a; font-weight: bold;">Active</span>
        {% else %}
            <span style="color: #dc2626; font-weight: bold;">Inactive</span>
        {% endif %}
    </p>
    <p><strong>Overall Progress:</strong> {{ user.get_progress_percentage() }}%</p>
    <p><strong>Last Login:</strong> {{ user.last_login.strftime('%Y-%m-%d %H:%M') if user.last_login else 'Never' }}</p>
    
    <div style="margin-top: 1rem;">
        <a href="{{ url_for('admin_reset_password', user_id=user.id) }}" class="btn btn-warning">Reset Password</a>
    </div>
</div>

<div class="card">
    <h2>Recent Study Logs</h2>
    {% if recent_study_logs %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Subject</th>
                <th>Duration</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for log in recent_study_logs %}
            <tr>
                <td>{{ log.date.strftime('%Y-%m-%d') }}</td>
                <td>{{ log.subject or 'All' }}</td>
                <td>{{ log.duration_minutes }} min</td>
                <td>{{ log.notes[:50] if log.notes else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #6b7280;">No study logs yet.</p>
    {% endif %}
</div>

<div class="card">
    <h2>Recent Test Scores</h2>
    {% if recent_tests %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Test Name</th>
                <th>Score</th>
                <th>Percentage</th>
            </tr>
        </thead>
        <tbody>
            {% for test in recent_tests %}
            <tr>
                <td>{{ test.test_date.strftime('%Y-%m-%d') }}</td>
                <td>{{ test.test_name }}</td>
                <td>{{ test.total_score }}/{{ test.total_marks }}</td>
                <td><strong>{{ test.percentage }}%</strong></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #6b7280;">No test scores yet.</p>
    {% endif %}
</div>

<div class="card">
    <h2>Chapter Progress</h2>
    <h3 style="margin-top: 1rem;">Physics</h3>
    <p>Completed: {{ physics_progress|selectattr('is_completed')|list|length }} / {{ physics_progress|length }}</p>
    
    <h3 style="margin-top: 1rem;">Chemistry</h3>
    <p>Completed: {{ chemistry_progress|selectattr('is_completed')|list|length }} / {{ chemistry_progress|length }}</p>
    
    <h3 style="margin-top: 1rem;">Biology</h3>
    <p>Completed: {{ biology_progress|selectattr('is_completed')|list|length }} / {{ biology_progress|length }}</p>
</div>
{% endblock %}
