{% extends "base.html" %}

{% block title %}Test Tracker - NEET Study Tracker{% endblock %}

{% block content %}
<h1>ðŸ“Š Test Score Tracker</h1>

<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-top: 2rem;">
    <div class="card">
        <h2 style="margin-bottom: 1.5rem;">Add Test Score</h2>
        
        <form method="POST" novalidate>
            {{ form.hidden_tag() }}
            
            <div class="form-group">
                {{ form.test_name.label(class="form-label") }}
                {{ form.test_name(class="form-control", placeholder="Mock Test 1") }}
            </div>
            
            <div class="form-group">
                {{ form.test_date.label(class="form-label") }}
                {{ form.test_date(class="form-control") }}
            </div>
            
            <div class="form-group">
                {{ form.test_type.label(class="form-label") }}
                {{ form.test_type(class="form-control") }}
            </div>
            
            <div class="form-group">
                {{ form.total_score.label(class="form-label") }}
                {{ form.total_score(class="form-control", placeholder="500") }}
            </div>
            
            <div class="form-group">
                {{ form.total_marks.label(class="form-label") }}
                {{ form.total_marks(class="form-control", placeholder="720") }}
            </div>
            
            <div class="form-group">
                {{ form.notes.label(class="form-label") }}
                {{ form.notes(class="form-control", rows="3") }}
            </div>
            
            {{ form.submit(class="btn btn-primary", style="width: 100%;") }}
        </form>
    </div>
    
    <div>
        <div class="card">
            <h2 style="margin-bottom: 1.5rem;">Score Progress Chart</h2>
            <canvas id="testChart" style="max-height: 300px;"></canvas>
        </div>
        
        <div class="card">
            <h2 style="margin-bottom: 1.5rem;">Test History</h2>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Test Name</th>
                        <th>Score</th>
                        <th>Percentage</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for test in tests %}
                    <tr>
                        <td>{{ test.test_date.strftime('%Y-%m-%d') }}</td>
                        <td>{{ test.test_name }}</td>
                        <td>{{ test.total_score }}/{{ test.total_marks }}</td>
                        <td><strong>{{ test.percentage }}%</strong></td>
                        <td>
                            <form method="POST" action="{{ url_for('delete_test', test_id=test.id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.875rem;" onclick="return confirm('Delete this test?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const testData = {{ chart_data|safe }};
const dates = testData.map(t => t.date);
const percentages = testData.map(t => t.percentage);

new Chart(document.getElementById('testChart'), {
    type: 'line',
    data: {
        labels: dates,
        datasets: [{
            label: 'Test Score %',
            data: percentages,
            borderColor: '#2563eb',
            backgroundColor: 'rgba(37, 99, 235, 0.1)',
            tension: 0.1,
            fill: true
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: { display: true, text: 'Test Score Progression' }
        },
        scales: {
            y: { beginAtZero: true, max: 100 }
        }
    }
});
</script>
{% endblock %}
