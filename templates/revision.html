{% extends "base.html" %}

{% block title %}Revision Tracker - NEET Study Tracker{% endblock %}

{% block content %}
<h1>üîÑ Revision Tracker</h1>

<div class="card">
    <h2 style="margin-bottom: 1.5rem;">Track Your Revision Progress</h2>
    
    <form method="POST" action="{{ url_for('add_revision') }}" novalidate>
        <div class="form-group">
            <label for="chapter" class="form-label">Chapter</label>
            <select id="chapter" name="chapter" class="form-control" required>
                <option value="">Select a chapter</option>
                {% for subject, chapters in NEET_SYLLABUS.items() %}
                    <optgroup label="{{ subject }}">
                        {% for chapter in chapters %}
                            <option value="{{ subject }}:{{ chapter }}">{{ chapter }}</option>
                        {% endfor %}
                    </optgroup>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="confidence" class="form-label">Confidence Level</label>
            <select id="confidence" name="confidence" class="form-control">
                <option value="">Select</option>
                <option value="1">‚≠ê Very Low</option>
                <option value="2">‚≠ê‚≠ê Low</option>
                <option value="3">‚≠ê‚≠ê‚≠ê Medium</option>
                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê High</option>
                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Very High</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="notes" class="form-label">Revision Notes</label>
            <textarea id="notes" name="notes" class="form-control" rows="3" placeholder="What did you revise? Any difficulties?"></textarea>
        </div>
        
        <button type="submit" class="btn btn-primary">Log Revision</button>
    </form>
</div>

<div class="card">
    <h2 style="margin-bottom: 1.5rem;">Revision History</h2>
    
    {% if revisions %}
    <table>
        <thead>
            <tr>
                <th>Chapter</th>
                <th>Date</th>
                <th>Confidence</th>
                <th>Notes</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for rev in revisions %}
            <tr>
                <td>{{ rev.chapter_name }}</td>
                <td>{{ rev.revision_date.strftime('%Y-%m-%d') }}</td>
                <td>
                    {% for i in range(rev.confidence_level|int) %}
                        ‚≠ê
                    {% endfor %}
                </td>
                <td>{{ rev.notes[:50] if rev.notes else '-' }}</td>
                <td>
                    <form method="POST" action="{{ url_for('delete_revision', rev_id=rev.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.875rem;" onclick="return confirm('Delete this revision?')">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #6b7280;">No revision logs yet.</p>
    {% endif %}
</div>

<div class="card">
    <h2 style="margin-bottom: 1.5rem;">Revision Analytics</h2>
    <canvas id="revisionChart" style="max-height: 300px;"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const revisionData = {{ revision_chart_data|safe }};
const dates = Object.keys(revisionData).sort();
const counts = dates.map(d => revisionData[d]);

new Chart(document.getElementById('revisionChart'), {
    type: 'bar',
    data: {
        labels: dates,
        datasets: [{
            label: 'Revisions per Day',
            data: counts,
            backgroundColor: '#8b5cf6'
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: { display: true, text: 'Revision Frequency' }
        }
    }
});
</script>
{% endblock %}
